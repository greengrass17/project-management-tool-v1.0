<md-content flex layout="column" ng-repeat="task in tasks">

  <div layout="row" flex>
    <md-content flex layout="column">

      <!-- common information -->
      <div layout-padding layout="row">
        <md-card layout-padding ng-repeat="list in listDetail" md-theme="{{list.listTheme}}" class="list-name">{{list.listName}}</md-card>
        <div ng-hide="editTaskName">
          <h2>{{task.taskName}}</h2>
          <md-button ng-click="editTaskName = !editTaskName">Edit</md-button>
          <md-button ng-click="testTaskMember()">test task member array</md-button>
        </div>
        <div ng-show="editTaskName">
          <input type="text" ng-model="data.taskName" class="md-headline" />
          <md-button ng-click="editTaskName = !editTaskName; saveTaskName()">Save</md-button>
          <md-button ng-click="editTaskName = !editTaskName">Cancel</md-button>
        </div>


        <md-button ng-click="tasks.$remove(task);close()" class="md-icon-button md-warn">
          <md-icon md-font-icon="fa fa-times" class="md-headline"></md-icon>
        </md-button>
      </div>
      <!-- Activity area -->
      <task-activity subject-id="id"></task-activity>
      <!--END Activity area-->
      <div layout="row" class="task-header">
        <md-input-container class="datepicker-container">
          <label>Start date</label>
          <datepicker date-format="dd/MM/yyyy">
            <input type="text" ng-model="task.startDate" ng-change="tasks.$save(task)">
          </datepicker>
        </md-input-container>
        <md-input-container class="datepicker-container">
          <label>End date</label>
          <datepicker date-format="dd/MM/yyyy">
            <input type="text" ng-model="task.endDate" ng-change="tasks.$save(task)">
          </datepicker>
        </md-input-container>
      </div>
      <!------------END common information------------>

      <!-- Check list area -->
      <div flex layout="column" layout-padding class="checklist">
        <div style="text-align: center;">{{task.percentOfChecklist | number: 0}} %
          <md-progress-linear md-theme="progress-state" class="md-primary" md-mode="determinate" value="{{task.percentOfChecklist}}"></md-progress-linear>
        </div>

        <ul flex class="checklist__list">
          <li ng-repeat="cl in checklist">
            <md-checkbox ng-model="cl.isDone" ng-change="checklist.$save(cl)" class="md-primary">
              {{cl.text}}
            </md-checkbox>
          </li>
        </ul>

        <p>Number of Check list: {{total}}</p>

        <form class="checklist__add" layout="row" layout-align="start center">
          <md-input-container flex>
            <label>New todos</label>
            <input type="text" ng-model="data.text" />
          </md-input-container>
          <md-button ng-click="addChecklist(); data.text=''" class="md-primary md-icon-button">
            <md-icon md-font-icon="fa fa-plus" class="md-headline"></md-icon>
          </md-button>
        </form>
      </div>
      <!--END Check list area-->

    </md-content>

    <md-sidenav md-component-id="right" md-is-locked-open="true" class="md-sidenav-right md-whiteframe-z2">
      <md-content flex layout="column">
        <md-subheader><span class="md-subhead">Members</span>
        </md-subheader>
        <div layout="row" class="member">
          <div ng-repeat="member in users | filterByUserId: taskMember" layout-padding>
            <span ng-repeat="profile in member.profile">
<md-button ng-click="addTaskMember(member.$id)">{{profile.firstName}}</md-button>
            </span>
          </div>
        </div>

        <!--END Member area-->

        <!-- message Area -->
        <md-subheader><span class="md-subhead">Messages</span>
        </md-subheader>
        <div flex layout="column">
          <div flex class="message__container">
            <div layout="column" layout-padding class="message">
              <div ng-repeat="msg in messages" layout="row" class="message__item" ng-class="senderIsMe(msg.sender) ? 'message__item--right' : '' ">
                <div ng-repeat="member in users | filterByUserId: msg.sender" ng-hide="senderIsMe(msg.sender)" layout layout-align="center center">
                  <span ng-repeat="profile in member.profile">{{profile.firstName}}</span>
                </div>
                <md-card flex layout-padding md-theme="message-bg">
                  {{msg.message}}
                </md-card>
              </div>
            </div>
          </div>

          <form layout="row" layout-align="start center" class="message__send" layout-padding>
            <md-input-container flex>
              <label>Message all</label>
              <input type="text" ng-model="data.msg" />
            </md-input-container>
            <md-button ng-click="sendMsg(); data.msg=''" class="md-icon-button md-primary">
              <md-icon md-font-icon="fa fa-paper-plane" class="md-headline"></md-icon>
            </md-button>
          </form>
        </div>
        <!-- END message area -->
      </md-content>
    </md-sidenav>

  </div>

</md-content>
